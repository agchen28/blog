---
date: 2017-04-25T11:13:00+08:00
draft: false
tags: [".NET"]
categories: ["技术相关"]
title: 线程同步构造
---
线程同步构造就是我们俗话说的锁。  
锁的作用就是确保一次只有一个线程访问资源。  
为什么需要锁呢？  
多个线程同时访问共享数据时（必须是共享数据，还有同时访问），锁能防止数据损坏。当然多个线程对共享数据进行只读访问是没有任何问题的。  

##  基元线程同步构造
基元指可以在代码中使用的最简单构造。  
有两种基元构造：用户模式（user-mode）和内核模式（kernel-mode）。  
### 用户模式构造
应尽量使用基元用户模式构造，它们的速度显著快于内核模式的构造。  
特点：  
使用了特殊的CPU指令来协调线程，意味着协调是在硬件中发生的，也意味着操作系统永远检测不到一个线程在基元用户模式的构造上阻塞了。由于在用户模式的基元构造上阻塞的线程池线程永远不认为以阻塞，所以线程池不会创建新线程来替换这种临时阻塞的线程。另外，这些CPU指令只阻塞线程相当短的时间。  
缺点： 
想要取得资源但暂时娶不到的线程会一直在用户模式中“自旋”，这会浪费CPU时间，这些CPU时间本可以用来处理另外一些更有用的工作，即使没有其他更有用的工作，更好的做法也是让CPU空闲，这还能省一些电。  
有两种基元用户模式线程同步构造：  

- 易变构造（volatile construct）  
在特定的时间，它在包含一个简单数据类型的变量上执行原子性的读或写操作。

- 互锁构造（interlocked construct）  
在特定的时间，它在包含一个简单数据类型的变量上执行原子性的读和写操作。

### 内核模式构造

## 混合线程同步构造