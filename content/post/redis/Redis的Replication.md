---
date: 2016-08-01T12:57:29+08:00
draft: false
tags: ["redis"]
categories: ["技术相关"]
title: Redis的Replication
---

### 主从复制功能
主从复制（master-slave replication）功能可以让从服务器成为主服务器的精确复制品。  

Redis 复制功能的几个特点：  

- Redis 使用异步复制。

- 一个主服务器可以有多个从服务器。

- 复制功能不会阻塞主服务器

- 复制功能也不会阻塞从服务器

- 复制功能可以单纯地用于数据冗余

### 配置
从服务器的配置文件添加下面配置：
```
slaveof 192.168.1.1 6379
masterauth <password>
```
也可以动态设置从服务器的主服务器：
```
SLAVEOF 192.168.1.1 10086
config set masterauth <password>
```

### 运作原理
当建立一个从服务器时，从服务器向主服务器发送一个 SYNC 命令。接到 SYNC 命令的主服务器将开始执行 BGSAVE ，并在保存操作执行期间，将所有新执行的写入命令都保存到一个缓冲区里面。  
当 BGSAVE 执行完毕后，主服务器将执行保存操作所得的 .rdb 文件发送给从服务器，从服务器接收这个 .rdb 文件， 并将文件中的数据载入到内存中。  
之后主服务器会以 Redis 命令协议的格式，将写命令缓冲区中积累的所有内容都发送给从服务器。

### 应用

#### 读写分离
redis的主从同步功能常见的应用就是读写分离：将读的压力分担到从服务器身上，主服务器只负责写的操作，从而缓解主服务器的压力。

#### 主从切换
假设主服务器挂掉，使用 SLAVEOF NO ONE 命令将一个从服务器变成主服务器，其他从服务器设置为与该服务器同步，从而实现主从切换。
