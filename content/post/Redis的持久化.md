---
date: 2016-08-05T12:58:40+08:00
draft: false
tags: ["redis"]
categories: ["技术相关"]
title: Redis的持久化
---

redis提供两种持久化方式。

### RDB
RDB 保存的是数据集。

#### 优点

- RDB 是一个非常紧凑的文件，它保存了 Redis 在某个时间点上的数据集。

- RDB 非常适用于灾难恢复：可以（在加密后）将它传送到别的数据中心。

- RDB 可以最大化 Redis 的性能：父进程在保存 RDB 文件时唯一要做的就是 fork 出一个子进程，然后这个子进程就会处理接下来的所有保存工作，父进程无须执行任何磁盘 I/O 操作。

- RDB 在恢复大数据集时的速度比 AOF 要快。

#### 缺点

- 服务器故障时可能会丢失几分钟的数据

- 当数据集非常庞大时，fork()子进程会非常耗时，造成服务器在几毫秒内停止处理客户端，如果这时候CPU非常紧张的话，停止时间可能会长达一秒

### AOF(AppendOnly File)
AOF 记录的是所有写操作命令，可以在后台对AOF 文件进行重写来减小文件的大小。

#### 优点

- 使用 AOF 持久化会让 Redis 变得非常耐久：可以设置不同的 fsync 策略。默认策略为每秒钟 fsync 一次，也就是每秒钟将缓存中的AOF写到磁盘上。

- AOF文件过大时，会自动在后台进行重写，重写过程原有的AOF文件不会丢失。

- AOF文件容易被读懂分析。

#### 缺点

- 对于相同的数据集来说，AOF 文件的体积通常要大于 RDB 文件的体积。

- 根据所使用的 fsync 策略，AOF 的速度可能会慢于 RDB 。

### 总结
如果追求数据安全性， 应该同时使用两种持久化功能。  
如果可以承受数分钟以内的数据丢失， 可以只使用 RDB 持久化。  
不推荐只使用 AOF 持久化。